@page "/"
@using MachineAPI;
@using MachineAPI.Entities;
@using MachineAPI.Models;
@using System.Collections;
@using System.Data;
@using System.Collections.Generic;
@using System.Net.Http.Json
@using System.Text.Json;
@using System.ComponentModel;
@using Newtonsoft.Json;
@inject MachineAPI.Services.AssetsServiceMongo AssetService
<PageTitle>Home</PageTitle>
<h1>Search</h1>
<br />
<div>
    <input type="button" style="width:180px" value="Search Asset/Machine:" @onclick="SearchAsset" />
    <input type="text" style="width:200px" @bind-value="@strSearchVal" />
</div>
<div>
    <br />
    <br />
    <input type="button" style="width:180px" value="Get Latest Machine" @onclick="ShowLatestMachine" />
</div>
<br />

@if (machines == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <thead>
        <tr>
            <th style='width:15%'>Machine Name</th>
            <th style='width:50%'>Asset Name</th>
            <th style='width:20%'>Series No</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var machine in machines)
        {
            @foreach (var asset in machine.Assets)
            {
                <tr>
                    <td style='width:15%'>@machine.MachineName</td>
                    <td style='width:40%'>@asset.Name</td>
                    <td style='width:10%'>@asset.SeriesNo</td>
                </tr>
            }
        }
    </tbody>
}

@code {
    private string? strSearchVal;
    private IEnumerable<MachineModel?> machines;

    private async Task? SearchAsset()
    {
        try
        {
            machines = null;
            if (!string.IsNullOrEmpty(strSearchVal))
            {
                machines = AssetService.Search(strSearchVal);
            }
            else
            {
                machines = AssetService.SearchAll();
            }
        }
        catch (Exception ex)
        {

        }
    }

    private async Task? ShowLatestMachine()
    {
        try
        {
            machines = null;
            machines = AssetService.GetLatestMachine();
        }
        catch (Exception ex)
        {
           
        }
    }
}